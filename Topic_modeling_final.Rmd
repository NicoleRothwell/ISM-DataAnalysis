---
title: 'Assignment 2: Topic Modeling'
author: "Kevin Frew (20742541) & Nicole Rothwell (21970548)"
date: "02/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
##Set up of the general environment:
```{r}
#pacman installs a package before loading it if it is not already installed
if (!require("pacman")) install.packages("pacman"); 
library(pacman)
pacman::p_load(tidyverse, dplyr, rtweet, lubridate, tidytext, Unicode, rvest, tm, scales, topicmodels, matrix, ldatuning, uanteda, stm, ggplot2, quanteda)
```

#Selecting the correct data for Topic modeling 
```{r}
malan_data <- tidy_malan_twitter %>%
  select(date,status_id,word) 
malan_data

sabc_data <- tidy_sabc_twitter %>%
  select(date,status_id,word) 
sabc_data

news_data <- tidy_news_twitter %>%
  select(date,status_id,word) 
news_data

government_data <- tidy_government_twitter %>%
  select(date,status_id,word) 
government_data

#The combined data set
twitter_data <- tidy_twitter%>%
  select(date,status_id,word)
tidy_twitter
```

# Creation of the Document Term Matricies (DTM)

##DTM for Mia Malan
```{r}
malan_dtm <- malan_data %>%
  count(status_id, word, sort=TRUE) %>%
  cast_dtm(document = status_id, term = word, value = n)
```

##DTM for News 24
```{r}
news_dtm <- news_data %>%
  count(status_id, word, sort=TRUE) %>%
  cast_dtm(document = status_id, term = word, value = n)
```

##DTM for SABC
```{r}
sabc_dtm <- sabc_data %>%
  count(status_id, word, sort=TRUE) %>%
  cast_dtm(document = status_id, term = word, value = n)
```

##DTM for Department of Health 
```{r}
government_dtm <- government_data %>%
  count(status_id, word, sort=TRUE) %>%
  cast_dtm(document = status_id, term = word, value = n)
```

##DTM for Department of all twitter data (combined dataset)
```{r}
twitter_dtm <- twitter_data %>%
  count(status_id, word, sort=TRUE) %>%
  cast_dtm(document = status_id, term = word, value = n)
```

##Finding K 

###Finding K for Malan 
```{r}
result <- FindTopicsNumber(
  malan_dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE)

FindTopicsNumber_plot(result)
```

###Finding K for News24 
```{r}
result <- FindTopicsNumber(
  news_dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE)

FindTopicsNumber_plot(result)
```

###Finding K for SABC 
```{r}
result <- FindTopicsNumber(
  sabc_dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE)

FindTopicsNumber_plot(result)
```

###Finding K for Governemnt data
```{r}
result <- FindTopicsNumber(
  government_dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE)

FindTopicsNumber_plot(result)
```

###Finding K for all twitter data (combined data set)
```{r}
result <- FindTopicsNumber(
  twitter_dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE)

 

FindTopicsNumber_plot(result)
```

#3 LDA plotting 

##3.1 LDA for mia_malan 

```{r}
mia_lda <- LDA(malan_dtm, k = 6, control = list(seed = 1234))

mia_lda

mia_lda_td <- tidy(mia_lda)

mia_lda_td
```

###3.1.1 Top terms mia_malan 
```{r}
mia_top_terms <- mia_lda_td %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>% #The top 10 words 
  ungroup() %>%
  arrange(topic, -beta)

  
mia_top_terms_vis <- mia_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  ggtitle("LDA Mia Malan")
  
mia_top_terms_vis
ggsave(mia_top_terms_vis, filename = "mia_top_terms_vis.png", path ="~/Desktop/A2/lda_graphs")
```

###3.1.2 Sentiment Mia Malan
```{r}
malan_lda_sentiment <- mia_lda_td %>%
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  group_by(topic) 
  
ggplot(malan_lda_sentiment, aes(x = sentiment, y = beta, fill = sentiment)) +
  geom_bar(stat = "identity") +
  labs(title = "Mia Milan Topic Sentiment") +
  scale_fill_discrete(name = "Sentiment")+
  facet_wrap(~topic) +
  theme_light() +
  theme_light()+
  theme(axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.background = element_rect("grey94"),
      panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
      panel.grid.minor.y = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank())

```
###3.1.3 Changes in Topic Sentiment by Time (Mia Malan)
```{r}
joined_malan_twitter <- left_join(mia_lda_td, tidy_malan_twitter,by = c("term" = "word")) %>%
  group_by(topic,date)%>%
  #access the bing lexicon
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  #count the positive and negative sentiment
  count(sentiment) %>% 
  # make the data wide
  spread(sentiment, n, fill = 0) %>% 
  #create a new column
  mutate(sentiment = positive - negative,
         topic = factor(topic)) 

ggplot(joined_malan_twitter, aes(x=date, y=sentiment, fill=topic)) + 
  geom_bar(stat="identity", position="stack") +
  labs(x= "", y= "Sentiment", title = "Mia Malan's Topic Sentiment over Time")+
  scale_fill_discrete(name = "Topics")+
  theme_light()+
  theme(panel.background = element_rect("grey94"),
        panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x=element_text(size=7.5),  # X axis text
        axis.text.y=element_text(size=7.5), # Y axis text
        plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10))
```

##3.2 LDA for News 24 
```{r}
news_lda <- LDA(news_dtm, k = 6, control = list(seed = 1234))

news_lda

news_lda_td <- tidy(news_lda)

news_lda_td
```

###3.2.1 Top terms News 24
```{r}
news_top_terms <- news_lda_td %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>%
  ungroup() %>%
  arrange(topic, -beta)

  
news_top_terms_vis <- news_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() + 
  ggtitle("LDA News24")
  
news_top_terms_vis
ggsave(news_top_terms_vis, filename = "news_top_terms_vis.png", path ="~/Desktop/A2/lda_graphs")
```

###3.2.2 Sentiment News 24
```{r}
news_lda_sentiment <- news_lda_td %>%
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  group_by(topic) 

ggplot(news_lda_sentiment, aes(x = sentiment, y = beta, fill = sentiment)) +
  geom_bar(stat = "identity") +
  labs(title = "News24 Topic Sentiment") +
  facet_wrap(~topic) +
  scale_fill_discrete(name = "Sentiment")+
  theme_light() +
  theme_light()+
  theme(axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.background = element_rect("grey94"),
      panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
      panel.grid.minor.y = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank())
```
###3.2.3 Changes in Topic Sentiment by Time (News24)
```{r}
joined_news_twitter <- left_join(news_lda_td, tidy_news_twitter,by = c("term" = "word")) %>%
  group_by(topic,date) %>%
  #access the bing lexicon
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  #count the positive and negative sentiment
  count(sentiment) %>% 
  # make the data wide
  spread(sentiment, n, fill = 0) %>% 
  #create a new column
  mutate(sentiment = positive - negative,
         topic = factor(topic)) 


ggplot(joined_news_twitter, aes(x=date, y=sentiment, fill=topic)) + 
  geom_bar(stat="identity", position="stack") +
  labs(x= "", y= "Sentiment", title = "News24's Topic Sentiment over Time")+
  scale_fill_discrete(name = "Topics")+
        theme_light()+
        theme(panel.background = element_rect("grey94"),
            panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
            panel.grid.minor.y = element_blank(),
            panel.grid.major.x = element_blank(),
            panel.grid.minor.x = element_blank(),
            axis.text.x=element_text(size=7.5),  # X axis text
            axis.text.y=element_text(size=7.5), # Y axis text
            plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
            axis.title.x = element_text(size = 10),
            axis.title.y = element_text(size = 10),
            legend.title = element_text(size = 10))
```

##3.3 LDA for SABC 
```{r}
sabc_lda <- LDA(sabc_dtm, k = 5, control = list(seed = 1234))

sabc_lda

sabc_lda_td <- tidy(sabc_lda)

sabc_lda_td
```

###3.3.1 Top terms SABC
```{r}
sabc_top_terms <- sabc_lda_td %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>%
  ungroup() %>%
  arrange(topic, -beta)

  
sabc_top_terms_vis <- sabc_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  ggtitle("LDA SABC")
  
sabc_top_terms_vis
ggsave(sabc_top_terms_vis, filename = "sabc_top_terms_vis.png", path ="~/Desktop/A2/lda_graphs")

```

###3.3.2 Sentiment SABC
```{r}
sabc_lda_sentiment <- sabc_lda_td %>%
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  group_by(topic) 
  
ggplot(sabc_lda_sentiment, aes(x = sentiment, y = beta, fill = sentiment)) +
  geom_bar(stat = "identity") +
  labs(title = "SABC Topic Sentiment") +
  scale_fill_discrete(name = "Sentiment")+
  facet_wrap(~topic) +
  theme_light() +
  theme_light()+
  theme(axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          panel.background = element_rect("grey94"),
          panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
          panel.grid.minor.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
          axis.text.x = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks = element_blank())
```
###3.3.3 Changes in Topic Sentiment by Time (SABC News)
```{r}
joined_sabc_twitter <- left_join(sabc_lda_td, tidy_sabc_twitter,by = c("term" = "word")) %>%
  group_by(topic,date) %>%
  #access the bing lexicon
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  #count the positive and negative sentiment
  count(sentiment) %>% 
  # make the data wide
  spread(sentiment, n, fill = 0) %>% 
  #create a new column
  mutate(sentiment = positive - negative,
         topic = factor(topic)) 


ggplot(joined_sabc_twitter, aes(x=date, y=sentiment, fill=topic)) + 
  geom_bar(stat="identity", position="stack") +
  labs(x= "", y= "Sentiment", title = "SABC News's Topic Sentiment over Time")+
  scale_fill_discrete(name = "Topics")+
        theme_light()+
        theme(panel.background = element_rect("grey94"),
            panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
            panel.grid.minor.y = element_blank(),
            panel.grid.major.x = element_blank(),
            panel.grid.minor.x = element_blank(),
            axis.text.x=element_text(size=7.5),  # X axis text
            axis.text.y=element_text(size=7.5), # Y axis text
            plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
            axis.title.x = element_text(size = 10),
            axis.title.y = element_text(size = 10),
            legend.title = element_text(size = 10))
```

##3.4 LDA for Government  
```{r}
government_lda <- LDA(government_dtm, k = 6, control = list(seed = 1234))

government_lda

government_lda_td <- tidy(government_lda)

government_lda_td
```

###3.4.1 Top terms Government
```{r}
government_top_terms <- government_lda_td %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>%
  ungroup() %>%
  arrange(topic, -beta)

  
government_top_terms_vis <- government_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  ggtitle("LDA Health/Government")
  
government_top_terms_vis
ggsave(government_top_terms_vis, filename = "government_top_terms_vis.png", path ="~/Desktop/A2/lda_graphs")
```

###3.4.2 Sentiment Government
```{r}
government_lda_sentiment <- government_lda_td %>%
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  group_by(topic) 

ggplot(government_lda_sentiment,aes(x = sentiment, y = beta, fill = sentiment)) +
  geom_bar(stat = "identity") +
  labs(title = "HealthZA Topic Sentiment") +
  scale_fill_discrete(name = "Sentiment")+
  facet_wrap(~topic) +
  theme_light() +
  theme_light()+
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.background = element_rect("grey94"),
        panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())
```
###3.4.3 Changes in Topic Sentiment by Time (HealthZA)
```{r}
joined_government_twitter <- left_join(government_lda_td, tidy_government_twitter,by = c("term" = "word")) %>%
  group_by(topic,date) %>%
  #access the bing lexicon
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  #count the positive and negative sentiment
  count(sentiment) %>% 
  # make the data wide
  spread(sentiment, n, fill = 0) %>% 
  #create a new column
  mutate(sentiment = positive - negative,
         topic = factor(topic)) 


ggplot(joined_government_twitter, aes(x=date, y=sentiment, fill=topic)) + 
  geom_bar(stat="identity", position="stack") +
  labs(x= "", y= "Sentiment", title = "HealthZA's Topic Sentiment over Time")+
  scale_fill_discrete(name = "Topics")+
        theme_light()+
        theme(panel.background = element_rect("grey94"),
            panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
            panel.grid.minor.y = element_blank(),
            panel.grid.major.x = element_blank(),
            panel.grid.minor.x = element_blank(),
            axis.text.x=element_text(size=7.5),  # X axis text
            axis.text.y=element_text(size=7.5), # Y axis text
            plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
            axis.title.x = element_text(size = 10),
            axis.title.y = element_text(size = 10),
            legend.title = element_text(size = 10))
```

#3.5 LDA for Media Agencies Combined
```{r}
twitter_lda <- LDA(twitter_dtm, k = 6, control = list(seed = 1234))
twitter_lda

twitter_lda_td <- tidy(twitter_lda)
twitter_lda_td

```

###3.5.1 Top terms for all the Media Agencies
```{r}
twitter_top_terms <- twitter_lda_td %>%
  group_by(topic) %>%
  slice_max(beta, n = 10) %>%
  ungroup() %>%
  arrange(topic, -beta)

twitter_top_terms_vis <- twitter_top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered() +
  ggtitle("LDA All sources")
  
twitter_top_terms_vis
ggsave(twitter_top_terms_vis, filename = "twitter_top_terms_vis.png", path ="~/Desktop/A2/lda_graphs")
```
###3.5.2 Sentiment for Media Agencies combined
```{r}
twitter_lda_sentiment <- twitter_lda_td %>%
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  group_by(topic) 

ggplot(twitter_lda_sentiment ,aes(x = sentiment, y = beta, fill = sentiment)) +
  geom_bar(stat = "identity") +
  labs(title = "Combined Media Agency Topic Sentiment") +
  scale_fill_discrete(name = "Sentiment")+
  facet_wrap(~topic) +
  theme_light() +
  theme_light()+
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.background = element_rect("grey94"),
        panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())
```
###3.5.3 Changes in Topic Sentiment by Time (Combined Media Agencies)
```{r}
joined_combined_twitter <- left_join(twitter_lda_td, tidy_twitter,by = c("term" = "word")) %>%
  group_by(topic,date) %>%
  #access the bing lexicon
  inner_join(get_sentiments("bing"), by = c("term" = "word")) %>%
  #count the positive and negative sentiment
  count(sentiment) %>% 
  # make the data wide
  spread(sentiment, n, fill = 0) %>% 
  #create a new column
  mutate(sentiment = positive - negative,
         topic = factor(topic)) 


ggplot(joined_combined_twitter, aes(x=date, y=sentiment, fill=topic)) + 
  geom_bar(stat="identity", position="stack") +
  labs(x= "", y= "Sentiment", title = "Combined Media Agency Topic Sentiment over Time")+
  scale_fill_discrete(name = "Topics")+
        theme_light()+
        theme(panel.background = element_rect("grey94"),
            panel.grid.major.y = element_line(linetype = "dashed",colour = "gray"),
            panel.grid.minor.y = element_blank(),
            panel.grid.major.x = element_blank(),
            panel.grid.minor.x = element_blank(),
            axis.text.x=element_text(size=7.5),  # X axis text
            axis.text.y=element_text(size=7.5), # Y axis text
            plot.title = element_text(size = 10,face="bold", family="sans", hjust = 0.5),
            axis.title.x = element_text(size = 10),
            axis.title.y = element_text(size = 10),
            legend.title = element_text(size = 10))
```

#4 Implement structured topic models (STM)

##4.1 Malan Structured Topic Modeling 
```{r include=FALSE}
malan_dfm <- malan_data %>%
  count(status_id, word ,sort = TRUE) %>%
  cast_dfm(status_id, word ,n)

malan_model <- stm(malan_dfm, K = 8, init.type = "Spectral")
summary(malan_model)
```
###4.1.1 Beta Graph
```{r}
 td_beta_malan <- tidy(malan_model)

beta_mia_malan <- td_beta_malan %>%
  group_by(topic) %>%
  top_n(10) %>%
  ungroup %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = topic)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~topic, scales = "free") +
  coord_flip()+
  ggtitle("Beta Graph Mia Malan")

ggsave(beta_mia_malan, filename = "beta_mia_malan.png", path ="~/Desktop/A2/lda_graphs")



```
###4.1.2 Gamma Graph MIA
```{r}
td_gamma_malan <- tidy((malan_model), matrix = "gamma", document_names = rownames(malan_dfm))

gamma_mia_graphs<- ggplot(td_gamma_malan, aes(gamma, fill = as.factor(topic))) +
  geom_histogram(show.legend = FALSE) + 
  facet_wrap(~topic, ncol = 3) +
  ggtitle("Gamma Graph Mia Malan")
  
ggsave(gamma_mia_graphs, filename = "gamma_mia_graphs.png", path ="~/Desktop/A2/lda_graphs")
mia_gamma_graphs
```

##4.2 SABC Structured Topic Modeling 
```{r}
sabc_dfm <- sabc_data %>%
  count(status_id, word ,sort = TRUE) %>%
  cast_dfm(status_id, word ,n)

sabc_model <- stm(sabc_dfm, K = 10, init.type = "Spectral")
summary(sabc_model)
```
###4.2.1 Beta Graph SABC
```{r}
 td_beta_sabc <- tidy(sabc_model)

beta_sabc <- td_beta_sabc %>%
  group_by(topic) %>%
  top_n(10) %>%
  ungroup %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = topic)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~topic, scales = "free") +
  coord_flip() +
  ggtitle("Beta Graph SABC")

ggsave(beta_sabc, filename = "beta_sabc.png", path ="~/Desktop/A2/lda_graphs")
```
###4.2.2 Gamma graph SABC
```{r}
td_gamma_sabc <- tidy((sabc_model), matrix = "gamma", document_names = rownames(sabc_dfm))

gamma_sabc_graph <- ggplot(td_gamma_sabc, aes(gamma, fill = as.factor(topic))) +
  geom_histogram(show.legend = FALSE) + 
  facet_wrap(~topic, ncol = 3) +
  ggtitle("Gamma Graph SABC")

ggsave(gamma_sabc_graph, filename = "gamma_sabc_graph.png", path ="~/Desktop/A2/lda_graphs")
```

##4.3 Government Structured Topic Modeling 

```{r}
government_dfm <- government_data %>%
  count(status_id, word ,sort = TRUE) %>%
  cast_dfm(status_id, word ,n)

government_model <- stm(government_dfm, K = 10, init.type = "Spectral")
summary(government_model)
```
###4.3.1 Beta graph government
```{r}
td_beta_government <- tidy(government_model)

beta_government <- td_beta_government %>%
  group_by(topic) %>%
  top_n(10) %>%
  ungroup %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = topic)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~topic, scales = "free") +
  coord_flip()+
  ggtitle("Beta Graph government")

ggsave(beta_government, filename = "beta_government.png", path ="~/Desktop/A2/lda_graphs")
```
###4.3.2 Gamma graph government
```{r}
td_gamma_government <- tidy((sabc_model), matrix = "gamma", document_names = rownames(government_dfm))

gamma_government_graph <- ggplot(td_gamma_government, aes(gamma, fill = as.factor(topic))) +
  geom_histogram(show.legend = FALSE) + 
  facet_wrap(~topic, ncol = 3)+
  ggtitle("GAMMA Graph government")

ggsave(gamma_government_graph, filename = "gamma_government_graph.png", path ="~/Desktop/A2/lda_graphs")
```

##4.4 News24 Structured Topic Modeling 

```{r}
news_dfm <- news_data %>%
  count(status_id, word ,sort = TRUE) %>%
  cast_dfm(status_id, word ,n)

news_model <- stm(news_dfm, K = 10, init.type = "Spectral")
summary(news_model)
```

###4.4.1 Beta Graph News24
```{r}
td_beta_news <- tidy(news_model)

beta_news <- td_beta_news %>%
  group_by(topic) %>%
  top_n(10) %>%
  ungroup %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = topic)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~topic, scales = "free") +
  coord_flip() +
  ggtitle("Beta Graph News 24")

ggsave(beta_news, filename = "beta_news.png", path ="~/Desktop/A2/lda_graphs")
```

###4.4.2 Gamma Graph News24
```{r}
td_gamma_news <- tidy((news_model), matrix = "gamma", document_names = rownames(news_dfm))

gamma_news <- ggplot(td_gamma_sabc, aes(gamma, fill = as.factor(topic))) +
  geom_histogram(show.legend = FALSE) + 
  facet_wrap(~topic, ncol = 3) +
  ggtitle("GAMMA Graph News24")

ggsave(gamma_news, filename = "gamma_news.png", path ="~/Desktop/A2/lda_graphs")
```

##4.5 All twitter sources data Structured Topic Modeling

```{r}
twitter_dfm <- twitter_data %>%
  count(status_id, word ,sort = TRUE) %>%
  cast_dfm(status_id, word ,n)

twitter_model <- stm(twitter_dfm, K = 10, init.type = "Spectral")
summary(twitter_model)
```
###4.5.1 Beta graph
```{r}
td_beta_twitter <- tidy(twitter_model)

beta_twitter <- td_beta_twitter %>%
  group_by(topic) %>%
  top_n(10) %>%
  ungroup %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = topic)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~topic, scales = "free") +
  coord_flip() +
  ggtitle("Beta Graph all twitter sources")

ggsave(beta_twitter, filename = "beta_twitter.png", path ="~/Desktop/A2/lda_graphs")
```
###4.5.2 Gamma graph
```{r}
td_gamma_twitter <- tidy((twitter_model), matrix = "gamma", document_names = rownames(twitter_dfm))

gamma_twitter <- ggplot(td_gamma_twitter, aes(gamma, fill = as.factor(topic))) +
  geom_histogram(show.legend = FALSE) + 
  facet_wrap(~topic, ncol = 3) +
  ggtitle("GAMMA Graph all twitter sources")

ggsave(gamma_twitter, filename = "gamma_twitter.png", path ="~/Desktop/A2/lda_graphs")
```


